<html>
	<head>
		<!-- Luke Mitchell, December 2014 -->
		<!-- https://github.com/lukem512/startcoin-minikey -->
		<title>StartCOIN Cryptobullion Redemption Tool</title>
		<meta charset="UTF-8"> 

		<!-- Favicon -->
		<link rel="shortcut icon" href="data:image/png;base64,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"/>
		<!-- End of Favicon -->

		<!-- Stylesheets -->
		<style>
//bootstrap.min.css
		</style>
		<!-- End of Stylesheets -->

		<!-- CryptoJS -->
		<script type="text/javascript">
//cryptojs.js	
		</script>
		<script type="text/javascript">
//cryptojs.sha256.js	
		</script>
		<script type="text/javascript">
//cryptojs.ripemd160.js
		</script>
		<!-- End of CryptoJS -->

		<!-- BitcoinJS-lib (StartCOIN-ified) -->
		<script type="text/javascript">
//securerandom.js
		</script>
		<script type="text/javascript">
//ellipticcurve.js
		</script>
		<script type="text/javascript">
//biginteger.js
		</script>
		<script type="text/javascript">
//bitcoinjs-lib.js
		</script>
		<script type="text/javascript">
//bitcoinjs-lib.base58.js
		</script>
		<script type="text/javascript">
//bitcoinjs-lib.address.js
		</script>
		<script type="text/javascript">
//bitcoinjs-lib.ecdsa.js
		</script>
		<script type="text/javascript">
//bitcoinjs-lib.eckey.js
		</script>
		<script type="text/javascript">
//bitcoinjs-lib.util.js
		</script>
		<!-- End of BitcoinJS-lib -->

		<script>
			// Generates a number of valid Mini keys
			var minikeychars = "123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";

			var mini2key = function(mini) {
				if (!Bitcoin.ECKey.isMiniFormat(mini)) return false;
				return new Bitcoin.ECKey(mini);
			}

			function buf2array(buf) {
				var rs = [];
				for(var i = 0; i < buf.length; i++) {
					rs.push(buf[i]);
				}
				return rs;
			}

			var candidate = function() {
				var mini = ["S"];
				var size = BigInteger.valueOf(minikeychars.length);
				var buf = BigInteger.fromByteArrayUnsigned(buf2array(Crypto.util.randomBytes(50).slice(0)));
				while (mini.length < 30) {
					var div = buf.divideAndRemainder(size);
					mini.push(minikeychars.charAt(div[1]));
					buf = div[0];
					if (buf.compareTo(BigInteger.ONE) <= 0) {
						console.log("Ran out of entropy with key only", mini.length, "long");
						return false;
					}
				}
				return mini.join('');
			}	

			var genmini = function() {
				var n = document.getElementById("n").value;
				var keysElem = document.getElementById("keys");

				if (parseInt(n) == NaN) {
					alert("Please enter the number of Minikeys to generate");
					return;
				}

				var i = 0;
				var tries = 0;
				while (i < n) {
					// make candidate key
					var mini = candidate();
					if (mini === false) continue;
					tries++;

					// test validity
					var hash = Crypto.SHA256(mini+"?");
					if (hash[0] != 0) continue;

					// make EC key
					if (!Bitcoin.ECKey.isMiniFormat(mini)) continue;
					var key = new Bitcoin.ECKey(mini);

					// display with address

					keysElem.innerHTML += mini + ":" + key.getBitcoinAddress() + "<br />";
					//console.log(mini + ":" + key.getBitcoinAddress() + ",");
					i++;
				}
			}

			var selectRange = function(containerid) {
				if (document.selection) {
		            var range = document.body.createTextRange();
		            range.moveToElementText(document.getElementById(containerid));
		            range.select();
		        } else if (window.getSelection) {
		            var range = document.createRange();
		            range.selectNode(document.getElementById(containerid));
		            window.getSelection().addRange(range);
		        }
		        window.prompt("Copy to clipboard by using CTRL+C then Enter", range);
			}
		</script>
	</head>
	<body>
		<div class="container">
			<div class="page-header">
				<h1 class="text-muted">StartCOIN Cryptobullion Generation Tool</h1>
				<p class="lead">This tool provides the ability to generate Minikeys and their corresponding StartCOIN addresses.</p>
			</div>

			<div class="row well">
				<div class="col-md-4">
					<span class="text-muted" style="font-size:0.8em;display:block;">Number of keys</span>
					<form class="form form-inline" role="form">
						<input type="text" id="n" class="form-control" value="" placeholder="50"></input>
						<input type="button" class="btn btn-default" class="form-control" value="Generate" onclick="genmini();"></input>
					</form>
				</div>

				<div class="col-md-2">
					<p style="font-size:5em;font-weight:bolder;">&rlhar;</p>
				</div>

				<div class="col-md-6">
					<div id="keys-container">
						<span class="text-muted" style="font-size:0.8em;display:block;">Generated keys (minikey:address) [<a href="#" onclick="selectRange('keys')">Select</a>]</span>
						<span id="keys" style="font-size:1em;font-weight:bold;font-family:Courier,monospace"></span>
					</div>
				</div>

			</div>
			<footer class="footer">
		    	<p>Created by <a href="https://twitter.com/LukeCrypto">LukeCrypto</a> for Mike Murphy &bullet; 2015 &bullet; StartCOIN Cryptobullion Project</p>
		    </footer>
		</div>
	</body>
</html>
